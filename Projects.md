# 公共测试版项目清单

> 范围：Journal Supabase（开放评审模型）

## 里程碑 0 — 发布定义

- [x] 确认公共测试范围：提交 → 开放讨论 → 评审意见 → 编辑决定 → 列表可见性
- [x] 确认评审模型：开放评审
- [x] 定义 SLO（可用性、错误预算、事件响应窗口）

## 里程碑 1 — P0 发布就绪

### CI / 质量门禁

- [x] 默认分支 `bun run build` 必须通过
- [x] 默认分支 `bun run lint` 必须通过
- [x] 默认分支 `bun run test` 必须通过
- [x] 添加最小测试覆盖：
  - [x] 鉴权路由（`/submit`、`/me`）
  - [x] 投稿创建/更新流程
  - [x] 评审意见创建/回复权限边界

### 发布流程

- [x] 保护默认分支（必须 PR）
- [x] 添加发布版本号（`0.1.0-beta.x`）
- [x] 为每次发布添加变更日志模板

## 里程碑 2 — P0 安全与滥用防护（兼容开放评审）

### RLS / 鉴权验证

- [ ] 公开可读策略与开放评审模型保持一致
- [ ] 验证写入路径要求已认证身份与关系校验
- [ ] 添加显式回归 SQL 检查：
  - [ ] 匿名写入被阻止
  - [ ] 禁止自我审稿
  - [ ] 跨投稿回复不匹配被阻止

### 反滥用

- [ ] 为评论/评审创建添加限流
- [ ] 发帖前要求账号验证
- [ ] 添加审核工具：举报、隐藏、恢复、禁言

## 里程碑 3 — P0 运维

### 环境与密钥

- [ ] 区分 dev/staging/prod 环境配置
- [ ] 验证生产域名的 OAuth 回调与站点 URL
- [ ] 确保前端只使用 anon key；不泄露 service role

### 迁移 / 回滚

- [ ] 定义迁移顺序与发布运行手册
- [ ] 为高风险架构变更提供回滚 SQL
- [ ] 完成一次完整预发演练：迁移 → 验证 → 回滚 → 重新迁移

### 监控 / 告警

- [ ] 前端错误追踪（Sentry 或同类）
- [ ] DB/API 错误率仪表盘与告警
- [ ] 业务 KPI 告警：投稿失败、登录失败、评审提交失败

## 里程碑 4 — P1 产品完整性

### 发现与可用性

- [ ] 已接受与评审中的列表分页
- [ ] 添加搜索（标题/作者/关键词）
- [ ] 添加排序与筛选（更新时间、活动）

### 开放评审体验

- [ ] 在投稿详情明确“开放评审”声明文案
- [ ] 线程式回复 / 引用回复 / 提及支持
- [ ] 发帖处可见社区规范

### 管理员操作

- [ ] 管理权限面板中的用户搜索
- [ ] 添加冻结/禁言控制
- [ ] 添加敏感操作审计日志视图

## 里程碑 5 — P1 文档与合规

- [ ] 生产部署指南
- [ ] 事件响应手册
- [ ] 隐私政策 / 条款 / 社区规则
- [ ] 公开“开放评审如何运作”页面

## 里程碑 6 — P2 增长与可靠性

- [ ] 通知流水线（邮件/站内）
- [ ] 指标看板（DAU、参与度、转化）
- [ ] 热列表与高负载查询的性能优化

## 发布门禁（必须全部勾选）

- [ ] 连续 7 天构建/校验/测试全绿
- [ ] 清单测试中无关键鉴权绕过
- [ ] 迁移 + 回滚演练通过
- [ ] 监控/告警完成验证并有值班负责人
- [ ] 产品内发布开放评审政策文案
